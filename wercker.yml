box: wercker/rvm
no-response-timeout: 30
build:
    steps:
        - rails-database-yml:
            service: postgresql
        - bundle-install
        # - script:
        #     name: Set up db
        #     code: RAILS_ENV=test bundle exec rake db:schema:load
        # - script:
        #     name: build clients
        #     code: bundle exec rake clients:build
        # - script:
        #     name: rspec + coverage
        #     code: bundle exec rake spec
        # # when we get here, we are done building and testing
        # - script:
        #     name: set database.yml
        #     code: mv config/database.yml.prod config/database.yml
        # - script:
        #     name: build assets
        #     code: RAILS_ENV=external bundle exec rake assets:precompile
        # - bundle-package
        # - script:
        #     name: make tar for S3 backup
        #     code: |
        #         mkdir wercker_output && tar --exclude=wercker_output -zcf wercker_output/$WERCKER_GIT_COMMIT.tgz ./
        # - studyflow/s3sync@1.0.0:
        #     key_id: $AWS_ACCESS_KEY_ID
        #     key_secret: $AWS_SECRET_ACCESS_KEY
        #     bucket_url: $AWS_BUCKET_URL
        #     source_dir: wercker_output
        # - script:
        #     name: delete tar for S3 backup
        #     code: |
        #         rm wercker_output/$WERCKER_GIT_COMMIT.tgz
    # after-steps:
    #     - sherzberg/slack-notify:
    #         subdomain: studyflow
    #         token: $SLACK_TOKEN
    #         channel: devs

deploy:
    steps:
#         - add-to-known_hosts:
#             hostname: sfstagerails1.studyflow.nl
#         - add-to-known_hosts:
#             hostname: sfstagerails2.studyflow.nl
#         - add-to-known_hosts:
#             hostname: sfprodrails1.studyflow.nl
#         - add-to-known_hosts:
#             hostname: sfprodrails2.studyflow.nl
#         - add-to-known_hosts:
#             hostname: sfprodrails3.studyflow.nl
#         - add-to-known_hosts:
#             hostname: sfprodrails4.studyflow.nl
#         - add-to-known_hosts:
#             hostname: sfprodrails5.studyflow.nl
#         - add-to-known_hosts:
#             hostname: sfprodrails6.studyflow.nl
#         - add-to-known_hosts:
#             hostname: sfprodrails7.studyflow.nl
#         - add-to-known_hosts:
#             hostname: sfprodrails8.studyflow.nl
#         - add-ssh-key:
#             keyname: DOCKER
#         - script:
#             name: install daemons gem
#             code: |
#                 gem install daemons
        - cap:
            stage: $STAGE
            tasks: deploy
#     after-steps:
#         - sherzberg/slack-notify:
#             subdomain: studyflow
#             token: $SLACK_TOKEN
#             channel: devs

services:
  - wercker/postgresql
